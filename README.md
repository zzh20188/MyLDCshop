# LDC Shop (Next.js + Workers)

[English](./README_EN.md)

---

åŸºäº **Next.js 16**ã€**Vercel Postgres**ã€**Shadcn UI** å’Œ **Linux DO Connect** æ„å»ºçš„å¼ºå¤§çš„æ— æœåŠ¡å™¨è™šæ‹Ÿå•†å“å•†åº—ã€‚

> ğŸ’¡ **ä¹Ÿæä¾› Cloudflare Workers ç‰ˆæœ¬ï¼š** [æŸ¥çœ‹éƒ¨ç½²æŒ‡å— â†’ `_workers_v2/README.md`](./_workers_v2/README.md)

## âœ¨ ç‰¹æ€§
- **ç°ä»£æŠ€æœ¯æ ˆ**: Next.js 16 (App Router), Tailwind CSS, TypeScript.
- **Vercel åŸç”Ÿ**: ä¸€é”®éƒ¨ç½²ï¼Œè‡ªåŠ¨é…ç½® Vercel Postgres æ•°æ®åº“ã€‚
- **Linux DO é›†æˆ**: å†…ç½® OIDC ç™»å½•ä¸ EasyPay æ”¯ä»˜ã€‚
- **å•†åŸä½“éªŒ**:
    - ğŸ” **æœç´¢ä¸åˆ†ç±»ç­›é€‰**: å®¢æˆ·ç«¯å³æ—¶æœç´¢ä¸åˆ†ç±»è¿‡æ»¤ã€‚
    - ğŸ“¢ **å…¬å‘Šæ **: é¦–é¡µå…¬å‘Šé…ç½®ä¸å±•ç¤ºã€‚
    - ğŸ“ **Markdown æè¿°**: å•†å“æ”¯æŒå¯Œæ–‡æœ¬å±•ç¤ºã€‚
    - ğŸ”¥ **çƒ­é—¨ä¸æŠ˜æ‰£**: æ”¯æŒçƒ­é—¨æ ‡è®°ä¸åŸä»·/æŠ˜æ‰£ä»·å±•ç¤ºã€‚
    - â­ **è¯„åˆ†ä¸è¯„è®º**: å·²è´­ç”¨æˆ·å¯è¯„åˆ†/è¯„è®ºï¼Œåˆ—è¡¨å±•ç¤ºè¯„åˆ†ã€‚
    - ğŸ“¦ **åº“å­˜/å·²å”®æ˜¾ç¤º**: å®æ—¶å±•ç¤ºå¯ç”¨åº“å­˜ä¸å·²å”®æ•°é‡ã€‚
    - ğŸš« **é™è´­**: æŒ‰å·²æ”¯ä»˜æ¬¡æ•°é™åˆ¶è´­ä¹°ã€‚
    - ğŸ·ï¸ **è‡ªå®šä¹‰å•†åº—åç§°**: æ”¯æŒè‡ªå®šä¹‰æ˜¾ç¤ºåœ¨æ ‡é¢˜å’Œå¯¼èˆªæ çš„å•†åº—åç§°ã€‚
- **è®¢å•ä¸å‘è´§**:
    - âœ… **æ”¯ä»˜å›è°ƒéªŒç­¾**: ç­¾åä¸é‡‘é¢æ ¡éªŒã€‚
    - ğŸ **è‡ªåŠ¨å‘è´§å¡å¯†**: æ”¯ä»˜æˆåŠŸåè‡ªåŠ¨å‘æ”¾å¡å¯†ï¼Œç¼ºè´§åˆ™æ ‡è®°å·²æ”¯ä»˜å¾…å¤„ç†ã€‚
    - ğŸ”’ **åº“å­˜é”å®š**: è¿›å…¥æ”¯ä»˜é¡µåé”å®š 1 åˆ†é’Ÿï¼Œé˜²æ­¢å¹¶å‘è¶…å–ã€‚
    - â±ï¸ **è¶…æ—¶å–æ¶ˆ**: 5 åˆ†é’Ÿæœªæ”¯ä»˜è‡ªåŠ¨å–æ¶ˆè®¢å•å¹¶é‡Šæ”¾åº“å­˜ã€‚
    - ğŸ§¾ **è®¢å•ä¸­å¿ƒ**: è®¢å•åˆ—è¡¨ä¸è¯¦æƒ…é¡µã€‚
    - ğŸ”„ **é€€æ¬¾ç”³è¯·**: ç”¨æˆ·å¯æäº¤é€€æ¬¾ç”³è¯·ï¼Œç®¡ç†å‘˜å®¡æ ¸ä¸å¤„ç†ã€‚
- **ç®¡ç†åå°**:
    - ğŸ“Š **é”€å”®ç»Ÿè®¡**: ä»Šæ—¥/æœ¬å‘¨/æœ¬æœˆ/æ€»è®¡ã€‚
    - âš ï¸ **åº“å­˜é¢„è­¦**: ä½åº“å­˜é˜ˆå€¼é…ç½®ä¸é¢„è­¦æç¤ºã€‚
    - ğŸ§© **å•†å“ç®¡ç†**: æ–°å»º/ç¼–è¾‘/ä¸Šä¸‹æ¶/æ’åº/é™è´­ã€‚
    - ğŸ·ï¸ **åˆ†ç±»ç®¡ç†**: åˆ†ç±»å¢åˆ æ”¹ã€å›¾æ ‡è®¾ç½®ã€æ’åºã€‚
    - ğŸ—‚ï¸ **åº“å­˜å¡å¯†ç®¡ç†**: æ‰¹é‡å¯¼å…¥ã€åˆ é™¤æœªä½¿ç”¨å¡å¯†ã€‚
    - ğŸ§¯ **åº“å­˜è‡ªæ„ˆ**: å…¼å®¹å†å²æ•°æ® `is_used` ä¸ºç©ºå¯¼è‡´çš„â€œé”™è¯¯ç¼ºè´§â€ï¼Œä¼šè‡ªåŠ¨å›å¡«ä¸º `false`ã€‚
    - ğŸ’³ **è®¢å•ä¸é€€æ¬¾**: åˆ†é¡µ/æœç´¢/ç­›é€‰ã€è®¢å•è¯¦æƒ…ã€æ ‡è®°å·²æ”¯ä»˜/å·²å‘è´§/å–æ¶ˆã€ä¸¤æ­¥é€€æ¬¾æµç¨‹ã€‚
    - ğŸ§¹ **è®¢å•æ¸…ç†**: æ”¯æŒæ‰¹é‡é€‰æ‹©ä¸æ‰¹é‡åˆ é™¤ã€‚
    - â­ **è¯„ä»·ç®¡ç†**: æœç´¢ä¸åˆ é™¤è¯„ä»·ã€‚
    - ğŸ“¦ **æ•°æ®å¯¼å‡º**: è®¢å•/å•†å“/è¯„ä»·/è®¾ç½®å¯¼å‡ºï¼Œæ”¯æŒå…¨é‡ JSON ä¸ D1 SQLã€‚
    - ğŸ“£ **å…¬å‘Šç®¡ç†**: é¦–é¡µå…¬å‘Šé…ç½®ã€‚
    - ğŸ’¾ **æ•°æ®å¯¼å‡º**: æ”¯æŒå¯¼å‡ºè®¢å•ã€å•†å“ã€è¯„ä»·ä¸º CSV/JSONï¼Œä»¥åŠå¯¼å‡ºå…¨é‡æ•°æ®ä¸º D1 å…¼å®¹ SQLã€‚
    - âš™ï¸ **è®¾ç½®**: è·Ÿéšå¿ƒæ„ä¿®æ”¹å•†åº—åç§°ã€‚
- **å¤šè¯­è¨€ä¸ä¸»é¢˜**:
    - ğŸŒ **ä¸­è‹±åˆ‡æ¢**ã€‚
    - ğŸŒ“ **æµ…è‰²/æ·±è‰²/è·Ÿéšç³»ç»Ÿ**ã€‚

## ğŸš€ ä¸€é”®éƒ¨ç½²

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https%3A%2F%2Fgithub.com%2Fchatgptuk%2Fldc-shop&env=OAUTH_CLIENT_ID,OAUTH_CLIENT_SECRET,MERCHANT_ID,MERCHANT_KEY,ADMIN_USERS,NEXT_PUBLIC_APP_URL&envDescription=Required%20Environment%20Variables&project-name=ldc-shop&repository-name=ldc-shop&stores=%5B%7B%22type%22%3A%22postgres%22%7D%5D)

ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å°†æ‚¨è‡ªå·±çš„å®ä¾‹éƒ¨ç½²åˆ° Vercelã€‚

æ•°æ®åº“ (Vercel Postgres) å°†ä¼šè‡ªåŠ¨é…ç½®å¹¶é“¾æ¥ã€‚

## â˜ï¸ Cloudflare Workers å‘½ä»¤éƒ¨ç½²

è¯·å‚è€ƒ [`_workers_v2/README.md`](./_workers_v2/README.md) ä½¿ç”¨ Wrangler å‘½ä»¤éƒ¨ç½²ä¸é…ç½®ã€‚

## âš ï¸ é‡è¦ï¼šå¿…é¡»ç»‘å®šè‡ªå®šä¹‰åŸŸå

**è¯·å‹¿ä½¿ç”¨ Vercel æä¾›çš„é»˜è®¤åŸŸå (`*.vercel.app`) è¿›è¡Œç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ï¼**

ç”±äº `vercel.app` æ˜¯å…±äº«åŸŸåï¼Œå¸¸è¢«é˜²ç«å¢™æˆ–æ”¯ä»˜å¹³å°åˆ—å…¥ä½ä¿¡èª‰åå•ï¼Œä¼šå¯¼è‡´ **æ”¯ä»˜å›è°ƒ (Notify) è¯·æ±‚è¢«æ‹¦æˆª**ï¼Œä»è€Œå‡ºç°"æ”¯ä»˜æˆåŠŸä½†è®¢å•çŠ¶æ€æœªæ›´æ–°"çš„é—®é¢˜ã€‚

**è§£å†³æ–¹æ¡ˆï¼š**
éƒ¨ç½²åï¼Œè¯·åŠ¡å¿…åœ¨ Vercelæ§åˆ¶å°ç»‘å®šä¸€ä¸ª**è‡ªå®šä¹‰åŸŸå**ï¼ˆå¦‚ `store.yourdomain.com`ï¼‰ï¼Œå¹¶ä½¿ç”¨è¯¥åŸŸåé…ç½® `NEXT_PUBLIC_APP_URL` å’Œæ”¯ä»˜å¹³å°çš„é€šçŸ¥åœ°å€ã€‚

## âš ï¸ é‡è¦ï¼šå…³äºé€€æ¬¾æ‹¦æˆªé—®é¢˜ (Refund WAF Issue)

Linux DO Credit çš„é€€æ¬¾ API å—åˆ° Cloudflare WAF çš„ä¸¥æ ¼ä¿æŠ¤ï¼Œç›´æ¥ä»æœåŠ¡å™¨ç«¯å‘èµ·è¯·æ±‚å¯èƒ½ä¼šè¢«æ‹¦æˆªï¼ˆæŠ¥é”™ 403 Forbiddenï¼‰ã€‚

**ç›®å‰çš„ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼š**
æœ¬é¡¹ç›®é‡‡ç”¨äº†**å®¢æˆ·ç«¯ API è°ƒç”¨æ–¹æ¡ˆ**ï¼ˆé€šè¿‡ Form è¡¨å•æäº¤ï¼‰ã€‚å½“ç®¡ç†å‘˜ç‚¹å‡»é€€æ¬¾æŒ‰é’®æ—¶ï¼Œä¼šæ‰“å¼€æ–°æ ‡ç­¾é¡µå¹¶ç”±æµè§ˆå™¨ç›´æ¥è°ƒç”¨ Linux DO Credit çš„é€€æ¬¾ APIã€‚ç®¡ç†å‘˜éœ€ç¡®è®¤ API è¿”å›æˆåŠŸåï¼Œè¿”å›æœ¬ç³»ç»Ÿç‚¹å‡»"æ ‡è®°å·²é€€æ¬¾"æ¥æ›´æ–°è®¢å•çŠ¶æ€ã€‚

## âš™ï¸ é…ç½®æŒ‡å—

éƒ¨ç½²æ—¶éœ€è¦é…ç½®ä»¥ä¸‹ç¯å¢ƒå˜é‡ã€‚

> **âš ï¸ æ³¨æ„**: 
> ä»¥ä¸‹é…ç½®ä»¥åŸŸå `store.chatgpt.org.uk` ä¸ºä¾‹ï¼Œ**éƒ¨ç½²æ—¶è¯·åŠ¡å¿…æ›¿æ¢ä¸ºä½ è‡ªå·±çš„å®é™…åŸŸåï¼**

### 1. Linux DO Connect (OIDC) é…ç½®
å‰å¾€ [connect.linux.do](https://connect.linux.do) åˆ›å»º/é…ç½®åº”ç”¨ï¼š

*   **åº”ç”¨åç§° (App Name)**: `LDC Store Next` (æˆ–ä»»æ„åç§°)
*   **åº”ç”¨ä¸»é¡µ (App Homepage)**: `https://store.chatgpt.org.uk`
*   **åº”ç”¨æè¿° (App Description)**: `LDC Store Next`
*   **å›è°ƒåœ°å€ (Callback URL)**: `https://store.chatgpt.org.uk/api/auth/callback/linuxdo`

è·å– **Client ID** å’Œ **Client Secret**ï¼Œåˆ†åˆ«å¡«å…¥ Vercel ç¯å¢ƒå˜é‡çš„ `OAUTH_CLIENT_ID` å’Œ `OAUTH_CLIENT_SECRET`ã€‚

### 2. EPay (Linux DO Credit) é…ç½®
å‰å¾€ [credit.linux.do](https://credit.linux.do) åˆ›å»º/é…ç½®åº”ç”¨ï¼š

*   **åº”ç”¨åç§°**: `LDC Store Next` (æˆ–ä»»æ„åç§°)
*   **åº”ç”¨åœ°å€**: `https://store.chatgpt.org.uk`
*   **å›è°ƒ URI**: `https://store.chatgpt.org.uk/callback`
*   **é€šçŸ¥ URL**: `https://store.chatgpt.org.uk/api/notify`

è·å– **Client ID** å’Œ **Client Secret**ï¼Œåˆ†åˆ«å¡«å…¥ Vercel ç¯å¢ƒå˜é‡çš„ `MERCHANT_ID` å’Œ `MERCHANT_KEY`ã€‚

### 3. å…¶ä»–å˜é‡
*   **ADMIN_USERS**: ç®¡ç†å‘˜ç”¨æˆ·åï¼Œé€—å·åˆ†éš”ï¼Œä¾‹å¦‚ `chatgpt,admin`
*   **NEXT_PUBLIC_APP_URL**: ä½ çš„åº”ç”¨å®Œæ•´åŸŸåï¼Œä¾‹å¦‚ `https://store.chatgpt.org.uk`

## ğŸ› ï¸ æœ¬åœ°å¼€å‘

1.  å…‹éš†ä»“åº“ã€‚
2.  å®‰è£…ä¾èµ–:
    ```bash
    npm install
    ```
3.  é“¾æ¥ Vercel é¡¹ç›® (ç”¨äºæ‹‰å–ç¯å¢ƒå˜é‡å’Œæ•°æ®åº“é…ç½®):
    ```bash
    vercel link
    vercel env pull .env.development.local
    ```
4.  è¿è¡Œæ•°æ®åº“è¿ç§»:
    ```bash
    npx drizzle-kit push
    ```
5.  å¯åŠ¨å¼€å‘æœåŠ¡å™¨:
    ```bash
    npm run dev
    ```

## ğŸ“„ è®¸å¯è¯
MIT
